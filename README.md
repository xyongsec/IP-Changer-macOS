# IP Changer macOSv1.0

`IP Changer` 是一款 macOS 应用程序，允许用户轻松更改其网络接口的 IP 地址。通过图形用户界面 (GUI)，用户可以选择网卡、配置 IP 地址，并验证 IP 配置的正确性。

## ✨ 功能

- **显示当前网卡状态**：查看当前网络接口的配置信息。
- **更改 IP 地址**：允许用户设置静态 IP 地址，支持 IPv4 格式。
- **输入校验**：在提交 IP 配置之前，验证 IP 格式的正确性。
- **支持动态和静态 IP 配置**：根据网络接口的配置状态提供相应的操作。

## 🔧 安装

### 1. 安装依赖

在运行脚本之前，请确保你已安装以下依赖：

- **Python 3.9** 或更高版本（建议使用 Python 3.8）
- **PyQt5**：用于图形用户界面（GUI）的库
- **psutil**：用于获取系统网络接口信息


# macOS IP 修改工具版本更新说明

## 版本 2.0 → 版本 1.0

### 🚀 主要改进

1. **全新的用户界面设计**
   - 采用现代化的分栏布局，左侧显示网卡信息和保存的配置，右侧为IP配置区域
   - 优化了控件排列和间距，提高用户体验
   - 添加了彩色按钮和更直观的视觉反馈

2. **增强的配置管理功能**
   - 新增配置列表视图，直观显示所有保存的配置
   - 添加一键加载配置功能，点击列表项即可填充表单
   - 实现配置删除功能，方便管理不再需要的配置

3. **改进的网卡信息显示**
   - 实时显示当前网卡状态（动态/静态IP）
   - 显示当前IP、子网掩码和网关信息
   - 网卡切换时自动更新显示信息

4. **代码结构优化**
   - 将UI初始化代码模块化，提高可读性
   - 添加更多注释和文档字符串
   - 改进错误处理和用户反馈

### 🐛 修复问题

1. 修复了某些情况下网卡信息无法正确显示的问题
2. 改进了IP地址验证逻辑，防止无效输入
3. 修复了配置文件加载时的潜在错误处理问题

### ⚙️ 技术细节

- 使用更高效的网络信息获取方式
- 改进了命令执行的安全性和可靠性
- 配置文件采用JSON格式，更易于手动编辑和备份

### 📦 安装与使用

使用方式与之前版本相同，但提供了更直观的操作界面：

1. 选择要配置的网络接口
2. 查看当前网络状态
3. 输入新的IP配置或从保存的配置中加载
4. 点击"修改IP"应用更改，或"恢复DHCP"切换回自动获取

建议删除旧版本的配置文件(`ip_configs.json`)，让程序重新生成新版格式的配置文件。

希望这个新版本能为您提供更好的网络配置体验！

# macOS IP 修改工具版本更新说明

## 版本 3 更新内容

### 新增功能

- **路由管理功能**：
  - 新增“路由信息表”分组，显示当前系统路由表（通过 `netstat -rn` 获取）。
  - 支持添加临时路由，包含目标网络、子网掩码和网关输入框。
  - 支持删除选中的临时路由。
- **实时输入校验**：
  - 为 IP、子网掩码、网关、路由目标网络、路由子网掩码和路由网关输入框添加实时格式校验。
  - 校验通过时显示绿色“✓”，失败时显示红色“✗”，并为输入框添加相应的边框颜色。
- **配置覆盖确认**：
  - 保存配置时，若配置名称已存在，会提示用户是否覆盖现有配置。
- **删除配置确认**：
  - 删除配置时，增加确认提示框，防止误操作。

### 界面改进

- **字体优化**：
  - 全局使用 macOS 原生字体 `SF Pro`，标题加粗，增强视觉层次。
  - 设置统一的字体大小（标签 14pt，输入框和列表 12pt）。
- **主题优化**：
  - 使用 `macos` 主题（`QStyleFactory.create("macos")`），替换之前的 `Macintosh` 主题，提供更现代化的 macOS 原生风格。
  - 按钮样式优化，添加 hover 效果，统一圆角（5px）和填充（8px）。
- **布局改进**：
  - 主窗口最小尺寸设为 600x400，确保内容完整显示。
  - 增加布局间距（`main_layout.setSpacing(10)`）和边距（`setContentsMargins(10, 10, 10, 10)`），提升界面美观度。
  - 为网卡下拉框和列表控件设置 `QSizePolicy.Expanding`，确保自适应窗口大小。
  - 左侧和右侧布局通过 `addStretch(1)` 优化空间分配。
- **路由管理分组**：
  - 新增“路由管理”分组，包含目标网络、子网掩码和网关输入框，以及“添加临时路由”按钮。

### 功能优化

- **配置文件路径**：
  - 配置文件存储路径从 `__file__` 目录更改为用户目录下的 `~/Library/Application Support/IPChanger/ip_configs.json`，符合 macOS 应用标准。
  - 自动创建配置文件目录（`os.makedirs`）。
- **错误处理**：
  - 增强异常捕获，初始化界面时捕获字体、主题、网卡列表和 UI 更新的异常，并显示友好提示。
  - 启动应用程序时添加全局异常捕获，记录错误并退出。
- **调试日志**：
  - 在 `initUI` 方法中添加详细的调试日志，记录界面初始化步骤，便于排查问题。
- **网卡选择校验**：
  - 在修改 IP 或切换 DHCP 时，增加网卡选择是否有效的校验，防止空网卡操作。
- **路由表加载**：
  - 使用 `netstat -rn | grep -E '^[0-9]'` 加载路由表，仅显示以数字开头的路由条目，确保数据清晰。

### 问题修复

- **网卡信息初始化**：
  - 修复 `status_value` 等属性可能未初始化的问题，增加属性存在性检查。
- **路由列表初始化**：
  - 修复路由列表可能未初始化的问题，增加 `hasattr` 检查。
- **配置列表初始化**：
  - 修复保存配置列表可能未初始化的问题，增加 `hasattr` 检查。

### 代码优化

- **代码结构**：
  - 优化布局代码，分组更清晰，逻辑分块更合理。
  - 统一按钮样式定义，使用多行字符串减少代码冗余。
- **输入校验逻辑**：
  - 将输入校验逻辑提取为独立方法 `validate_input`，支持多个输入框的动态校验。
- **路由操作**：
  - 使用 `route -n add` 和 `route -n delete` 命令实现临时路由的添加和删除，带管理员权限。

### 已知问题

- 路由管理仅支持临时路由，系统重启后路由会丢失（后续版本可考虑持久化路由）。
- 部分 macOS 系统版本可能对 `networksetup` 命令响应较慢，可能导致 UI 延迟。
- 字体 `SF Pro` 在某些 macOS 版本可能不可用，需进一步测试兼容性。

### 升级建议

- **备份配置文件**：升级前建议备份旧版本的 `ip_configs.json` 文件。
- **测试环境**：建议在 macOS 12（Monterey）及以上版本测试，确保 `networksetup` 和 `route` 命令兼容。
- **权限检查**：确保运行时具有管理员权限（通过 `osascript` 提示）。
